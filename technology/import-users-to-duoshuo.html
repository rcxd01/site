<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="屠城 | 屠夫9441 | 独立博客 | Hexo | Typecho | Wordpress | 心情 | 随笔"><title>同步用户到多说实现文章被评论时的提醒功能 | 屠城</title><link rel="stylesheet" href="../css/style-4.1.2.css"><link rel="stylesheet" href="../normalize/8.0.1/normalize.min.css"><link rel="stylesheet" href="../pure/1.0.0/pure-min.css"><link rel="stylesheet" href="../pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="../font-awesome/4.7.0/css/font-awesome.min.css"><script src="../jquery/3.4.0/jquery.min.js"></script><script src="../es6-promise/4.1.1/es6-promise.auto.min.js" async=""></script><link rel="manifest" href="../favicons/manifest-8j6Eo5no4g.css"><meta name="msapplication-TileColor" content="#2d89ef"><meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png?v=8j6Eo5no4g"><meta name="msapplication-config" content="/favicons/browserconfig.xml?v=8j6Eo5no4g"><meta name="theme-color" content="#ffffff"><link rel="alternate" type="application/atom+xml" href="../atom.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">同步用户到多说实现文章被评论时的提醒功能</h1><a id="logo" href="../Index.html">屠城</a><p class="description">屠夫9441的博客</p></div><div id="nav-menu"><a class="current" href="../Index.html"><i class="fa fa-home">首页</i></a> <a href="../archives/Index.html"><i class="fa fa-archive">归档</i></a> <a href="../about/Index.html"><i class="fa fa-user">关于</i></a> <a href="../history/Index.html"><i class="fa fa-book">历史</i></a> <a href="../guestbook/Index.html"><i class="fa fa-comments">留言</i></a> <a href="../atom.html"><i class="fa fa-rss">订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">同步用户到多说实现文章被评论时的提醒功能</h1><div class="post-meta">Jan 31, 2015 <span>|</span> <span class="category"><a href="../categories/technology/Index.html">technology</a></span></div><a class="disqus-comment-count" data-disqus-identifier="technology/import-users-to-duoshuo.html" href=""></a><div class="post-content"><p>绝大多数国内的静态博客用户使用的第三方评论系统应该都是多说，然而默认情况下，只有在用户被回复时（即别人点击某条评论下的“回复”按钮），被回复者才会收到多说的提醒和邮件通知；当读者首次评论一篇文章时，文章的作者是无法收到通知的，只能自己去多说后台查看，这给一些强迫症患者带来诸多不便。</p><p>不过，多说官方提供了“<a href="javascript:;" target="_blank" rel="noopener">同步用户到多说</a>”的API接口，接口说明中提到：“同步用户信息到多说，用于历史评论中用户的展示，站点管理权限的匹配，以及<strong>文章被评论时的提醒</strong>等功能。”实现方式是通过提交POST请求。下面我们就用JavaScript写一段代码然后执行，简单粗暴地提交一个POST请求，利用这个接口实现我们需要的功能。（当然你可以用任何语言写成脚本然后执行，jQuery、Node.js、PHP等等都行。）</p><p>新建一个HTML文件，在其中输入以下代码：</p><figure class="highlight xml"><figcaption><span>duoshuo.html</span><a href="../Index.html">duoshuo.html</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> xmlHttpRequest;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">createXmlHttpRequest</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(<span class="built_in">window</span>.ActiveXObject)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span></span><br><span class="line"><span class="javascript">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> url = <span class="string">"http://api.duoshuo.com/users/import.json"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> data = <span class="string">"short_name=***&amp;secret=*********************************&amp;users[0][user_key]=1&amp;users[0][name]=***&amp;users[0][email]=***@***.***"</span></span></span><br><span class="line"><span class="undefined">xmlHttpRequest = createXmlHttpRequest();</span></span><br><span class="line"><span class="javascript">xmlHttpRequest.open(<span class="string">"POST"</span>,url,<span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined">xmlHttpRequest.onreadystatechange = callback;</span></span><br><span class="line"><span class="javascript">xmlHttpRequest.setRequestHeader(<span class="string">"Content-Length"</span>,data.length);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">xmlHttpRequest.setRequestHeader(<span class="string">"Content-Type"</span>,</span></span><br><span class="line"><span class="javascript">            <span class="string">"application/x-www-form-urlencoded;"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">xmlHttpRequest.send(data);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(xmlHttpRequest.readyState == <span class="number">4</span>)&#123;<span class="keyword">if</span>(xmlHttpRequest.status == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="undefined">        alert(xmlHttpRequest.responseText);</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中，short_name为站点申请的多说二级域名；secret为多说后台设置中显示的站点密钥；user[0][user_key]为导入的用户在当前站点的ID；users[0][name]为导入用户的显示名，users[0][email]为接收提醒的邮箱地址。</p><p>将这些相关参数修改成自己站点对应的以后，保存为.html格式的文件，直接用浏览器打开执行，如果弹出的提示框中的返回信息包含“code”:0，说明执行正确，用户导入成功。这时多说的后台用户应该显示出导入的用户，如下图所示（其中第二个用户为通过POST请求导入的用户）：</p><p><img src="../images/04FD2702-3AB8-4680-83D1-64DF8747.png" alt="多说后台用户"></p><p>最后，在主题中调用多说评论框代码的地方加上data-author-key=”1”这一项，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ds-thread"</span> data-thread-key=<span class="string">"&lt;%- page.path %&gt;"</span> data-title=<span class="string">"&lt;%- page.title %&gt;"</span> data-url=<span class="string">"&lt;%- page.permalink %&gt;"</span> data-author-key=<span class="string">"1"</span>&gt;</span><br></pre></td></tr></table></figure><p>其实这里的data-author-key的值只要跟刚才导入用户时输入的users[0][user_key]的值保持一致即可。这样一来，我们在Hexo发布的文章都会具备author-key=”1”的属性，从而能与多说后台user_key为1的用户对应上，由该作者发表的文章被评论时，多说便会知道，从而进行邮件通知。</p><p>但是，目前还无法实现文章被评论后实时收到邮件通知，邮件通知的频率是每天一封。这是由多说的系统设置决定的（已得到多说技术人员确认），用户暂时无法更改。每天凌晨会有一封邮件发送到邮箱，列出今日收到的评论，大概样子是这样的：</p><p><img src="../images/1ECF4A9B-F1AE-47B6-AE07-9AD6084E.png" alt="多说邮件通知"></p><script>window.disqusProxy={shortname:"haomwei",username:"屠夫9441",server:"disqus.haomwei.com",port:443,adminAvatar:"/avatars/admin-avatar.jpg",identifier:"technology/import-users-to-duoshuo.html"},window.disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.disqusProxy.identifier}</script></div><script src="../js/share-4.1.2.js" async=""></script><a class="article-share-link" data-url="https://www.haomwei.com/technology/import-users-to-duoshuo.html" data-id="cjvj7pix10088kbbohv432y2d" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACsklEQVR42u3awW7jMAwE0P7/T+8CvRZOZkgp7eH5FKS1o+eDRAz59RVf/76vn59ff/Pz+6e/Js9/etqBCw8PD2+09KerXe5r/OvPyTf5mvHw8PBu85LDYPgDoz389YtL1oyHh4f3F3hn69XkdeRlNx4eHt5f5iWHQVs6b0pzPDw8vN/iJZt7ErO2+M0aDmcteHh4eEezgjyK/cznD/X38PDw8MooId9w87J4U7LXq8XDw8O7wJs1mWY78KmRrLx5hoeHh3ePtxkaSJ7QBhD5S2xDXjw8PLw9b7bEdlCgjYBz2Jtv8PDw8C7w8qGoTWsqKZfzV1AfQnh4eHhHefkN7VI27at9nFFMk+Hh4eEdSjXbB7VbdjuSlaznTQMMDw8P7yivvbmNd/etrFnUi4eHh3ePt2k7tcVxe3i0ycrjZAQeHh7eB3mz0CHZ1pP/3A8o4OHh4d3jJRtxu+hTcXB7kET9PTw8PLwRb/bQZICgPTxm7bc35TseHh7eNd5+iKodDkhe3L7NhoeHh3eP1y5039pvkcPyGg8PD+8Cb1aqtsFrvvRNoLzKWvDw8PBGvFl7qS2IN+Oqh4eu8PDw8Ea8PIyYjQW07bRZUf54Lx4eHt4F3iwsyLfve4MFdXCMh4eHd5TXtrX2kUT+Ot4MByRPwMPDwzvKSx6a/MCmzb8Ji98EHHh4eHiXeZuw9fVzZoFCfkQ9foOHh4d3gdfGrDeOhHwNs7QBDw8P7yyvLlLjeGI2OpC04oq78PDw8C7w8iu/ef/DbXmdB8F4eHh4p3g3tuxNW2tT1uPh4eF9kjcLJvKBrSQyboOPKJ7Aw8PD+1Ve0r7a/P++AYaHh4f3N3mzPlt+JOSjBtHrw8PDw7vGy8OIdqBqNjrQhhR4eHh4n+TtG2B57Js3wGZF9vDCw8PDS3n/AV2gxTq5wN2DAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="../tags/technology/Index.html">技术</a><a href="javascript:;">Internet</a><a href="../tags/blog/Index.html">博客</a><a href="javascript:;">Hexo</a><a href="../tags/duoshuo/Index.html">多说</a></div><div class="post-nav"><a class="pre" href="../emotion/realization.html">悟</a><a class="next" href="../emotion/a-special-dream.html">梦一场</a></div><script src="../react/16.0.0/umd/react.production.min.js"></script><script src="../react-dom/16.0.0/umd/react-dom.production.min.js"></script><script src="../fetch/2.0.3/fetch.min.js"></script><script src="../npm/blockies-identicon@0.1.0/blockies.min.js"></script><link rel="stylesheet" href="../font-awesome/4.7.0/css/font-awesome.min.css"><div id="disqus_proxy_thread"><script src="../scripts/hexo-disqus-proxy-primary.js" async=""></script><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script>var disqus_config=function(){this.page.url="https://www.haomwei.com/technology/import-users-to-duoshuo.html",this.page.identifier="technology/import-users-to-duoshuo.html",this.page.title="同步用户到多说实现文章被评论时的提醒功能"}</script><script id="disqus-lazy-load-script">$.ajax({url:"https://disqus.com/next/config.json",timeout:2500,type:"GET",success:function(){var s=document.createElement("script");s.src="//haomwei.disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),$(".disqus_click_btn").css("display","none")},error:function(){$(".disqus_click_btn").css("display","block")}})</script><script id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//haomwei.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script id="disqus-count-script">$(function(){var n=new XMLHttpRequest;n.open("GET","//disqus.com/next/config.json",!0),n.timeout=2500,n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){$(".post-meta .post-comments-count").show();var t=document.createElement("script");t.id="dsq-count-scr",t.src="https://haomwei.disqus.com/count.js",t.async=!0,(document.head||document.body).appendChild(t)}},n.ontimeout=function(){n.abort()},n.send(null)})</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://www.haomwei.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/emotion/Index.html">emotion</a></li><li class="category-list-item"><a class="category-list-link" href="../categories/technology/Index.html">technology</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">标签</i></div><div class="tagcloud"><a href="../tags/wudaokou/Index.html" style="font-size:15px">五道口</a> <a href="../tags/emotion/Index.html" style="font-size:15px">心情</a> <a href="../tags/music/Index.html" style="font-size:15px">音乐</a> <a href="../tags/sports/Index.html" style="font-size:15px">体育</a> <a href="javascript:;" style="font-size:15px">NBA</a> <a href="../tags/technology/Index.html" style="font-size:15px">技术</a> <a href="javascript:;" style="font-size:15px">Internet</a> <a href="javascript:;" style="font-size:15px">Typecho</a> <a href="../tags/movie/Index.html" style="font-size:15px">电影</a> <a href="../tags/manuscript/Index.html" style="font-size:15px">随笔</a> <a href="../tags/eat/Index.html" style="font-size:15px">吃</a> <a href="../tags/jeffery/Index.html" style="font-size:15px">李杨</a> <a href="../tags/blog/Index.html" style="font-size:15px">博客</a> <a href="javascript:;" style="font-size:15px">Wordpress</a> <a href="javascript:;" style="font-size:15px">GitHub</a> <a href="javascript:;" style="font-size:15px">Hexo</a> <a href="../tags/duoshuo/Index.html" style="font-size:15px">多说</a> <a href="javascript:;" style="font-size:15px">VPS</a> <a href="../tags/host/Index.html" style="font-size:15px">主机</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="../emotion/appearance.html">冒泡</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/south.html">南方</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/new-year.html">新年</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/half-year-2.html">半年志II</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/stay-alone.html">独处</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/just-say-something.html">杂谈</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/forget-me.html">忘了我</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/dishearted.html">继续丧</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/caprice2.html">一点随想II</a></li><li class="post-list-item"><a class="post-list-link" href="../emotion/about-memory.html">关于记忆</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link">友情链接</i></div><ul></ul><a href="javascript:;" title="雅岚文艺博客" target="_blank">雅岚文艺博客</a><ul></ul><a href="javascript:;" title="羽中漫步" target="_blank">羽中漫步</a><ul></ul><a href="javascript:;" title="灰常记忆" target="_blank">灰常记忆</a><ul></ul><a href="javascript:;" title="怡红院落" target="_blank">怡红院落</a><ul></ul><a href="javascript:;" title="云淡风轻" target="_blank">云淡风轻</a><ul></ul><a href="javascript:;" title="生活志" target="_blank">生活志</a><ul></ul><a href="javascript:;" title="葛豪武" target="_blank">葛豪武</a><ul></ul><a href="javascript:;" title="拿破林" target="_blank">拿破林</a><ul></ul><a href="javascript:;" title="浩子" target="_blank">浩子</a><ul></ul><a href="javascript:;" title="lmintlcx" target="_blank">lmintlcx</a><ul></ul><a href="javascript:;" title="QistChan" target="_blank">QistChan</a><ul></ul><a href="javascript:;" title="James Pan's Blog" target="_blank">James Pan's Blog</a><ul></ul><a href="javascript:;" title="dloptimber的九点半" target="_blank">dloptimber的九点半</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="../Index.html" rel="nofollow">屠城</a> | <a rel="nofollow" target="_blank" href="javascript:;">京ICP备15030820号</a> |&nbsp<img class="nofancybox" src="../img/beian.png" style="margin-bottom:-4px"> <a rel="nofollow" target="_blank" href="javascript:;">京公网安备11010502030691号</a><br><a rel="nofollow" target="_blank" href="javascript:;"><img class="nofancybox" src="../img/bitmoe.png" alt="bitmoe"></a></div></div></div><a class="show" id="rocket" href=""></a><script src="../js/totop-4.1.2.js" async=""></script><script src="../fancybox/3.5.7/jquery.fancybox.min.js" async=""></script><script src="../js/fancybox-4.1.2.js" async=""></script><link rel="stylesheet" href="../fancybox/3.5.7/jquery.fancybox.min.css"><script src="../js/codeblock-resizer-4.1.2.js"></script><script src="../js/smartresize-4.1.2.js"></script></div></body></html>